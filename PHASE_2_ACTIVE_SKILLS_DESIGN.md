# 🎯 塔防第二阶段：主动技能系统

## 📋 当前进度

### ✅ 第一阶段完成（100%）
- ✅ 6种防御塔类型
- ✅ 10种怪物类型（含4种特殊怪物）
- ✅ 完整战斗系统
- ✅ 数据持久化
- ✅ 波次预览UI
- ✅ 伤害飘字效果

---

## 🚀 第二阶段：主动技能系统

### 设计目标
为玩家提供**3种主动技能**，在关键时刻扭转战局，增加游戏的策略性和趣味性。

---

## 💡 技能设计

### 1️⃣ 空袭（Airstrike）
**类型**：区域AOE伤害  
**效果**：
- 对选定区域内所有敌人造成大量伤害
- 伤害：**100-150**（可秒杀早期怪物）
- 范围：**半径 2.5**
- 冷却时间：**60秒**
- 消耗：**100金币**

**使用场景**：
- 大量敌人聚集时
- 清理治疗单位
- 应对Boss波

**视觉效果**：
- 红色目标圈指示范围
- 导弹从天而降
- 爆炸光效 + 粒子效果

---

### 2️⃣ 冰冻（Freeze）
**类型**：区域控制  
**效果**：
- 冻结区域内所有敌人
- 冻结时间：**3秒**（敌人完全静止）
- 范围：**半径 3.0**
- 冷却时间：**45秒**
- 消耗：**80金币**

**使用场景**：
- 拖延快速单位（Runner）
- 配合塔集火Boss
- 阻止敌人到达基地

**视觉效果**：
- 蓝色冰冻圈
- 敌人变蓝色 + 冰晶特效
- 冰块粒子效果

---

### 3️⃣ 闪电链（Lightning Chain）
**类型**：链式伤害  
**效果**：
- 对目标及周围敌人造成链式伤害
- 初始伤害：**80**
- 链条数量：**最多5个目标**
- 每次跳跃衰减：**20%**（80 → 64 → 51 → 41 → 33）
- 跳跃范围：**1.5**
- 冷却时间：**30秒**
- 消耗：**60金币**

**使用场景**：
- 中等密度敌群
- 快速清理弱小敌人
- 连击积分奖励

**视觉效果**：
- 黄色闪电连线
- 电弧跳跃动画
- 击中闪光效果

---

## 🏗️ 技术架构

### 文件结构
```
src/js/td/
├── active-skills.js          # 技能系统核心（NEW）
├── skill-effects.js           # 技能视觉效果（NEW）
└── tower-defense-world.js     # 集成技能系统

src/components/td/
├── SkillBar.vue               # 技能UI组件（NEW）
└── TowerDefenseUI.vue         # 集成技能栏
```

### 技能系统核心类

```javascript
// active-skills.js
export class SkillSystem {
  constructor(world) {
    this.world = world
    this.skills = {
      airstrike: new AirstrikeSkill(),
      freeze: new FreezeSkill(),
      lightning: new LightningSkill()
    }
  }
  
  // 使用技能
  useSkill(skillId, targetPosition) {
    const skill = this.skills[skillId]
    if (!skill.canUse()) return false
    
    skill.activate(targetPosition, this.world)
    skill.startCooldown()
    return true
  }
}

// 基础技能类
export class ActiveSkill {
  constructor(config) {
    this.id = config.id
    this.name = config.name
    this.cooldown = config.cooldown
    this.cost = config.cost
    this.lastUsedTime = 0
  }
  
  canUse() {
    const now = Date.now()
    return (now - this.lastUsedTime) >= this.cooldown * 1000
  }
  
  getRemainingCooldown() {
    const elapsed = (Date.now() - this.lastUsedTime) / 1000
    return Math.max(0, this.cooldown - elapsed)
  }
}
```

---

## 🎨 UI设计

### 技能栏布局
位置：屏幕底部中央，开始波次按钮下方

```
┌─────────────────────────────────────┐
│  [🚀 空袭]  [❄️ 冰冻]  [⚡ 闪电链]  │
│   60s/60s    45s/45s     30s/30s     │
│    💰100      💰80       💰60        │
└─────────────────────────────────────┘
```

### 技能按钮状态
1. **可用**：彩色 + 悬停放大
2. **冷却中**：灰色 + 冷却进度圈
3. **金币不足**：红色边框 + 禁用
4. **使用中**：选择目标状态

### 选择目标模式
点击技能后：
1. 鼠标变为技能图标
2. 地面显示范围指示圈
3. 点击地面确认位置
4. 右键取消

---

## 📊 数据流

```
用户点击技能按钮
    ↓
检查冷却 & 金币
    ↓
进入目标选择模式
    ↓
点击地面选择位置
    ↓
扣除金币 & 执行技能
    ↓
应用效果 + 播放动画
    ↓
开始冷却计时
```

---

## ⚡ 性能优化

### 技能效果优化
- 使用对象池管理粒子
- 及时清理过期特效
- 限制同时存在的特效数量

### 碰撞检测优化
- 空间分区（Spatial Hashing）
- 只检测技能范围内的敌人
- 批量处理伤害

---

## 🧪 测试清单

### 空袭技能测试
- [ ] 范围指示正确显示
- [ ] 伤害计算正确
- [ ] 能击杀多个敌人
- [ ] 动画流畅
- [ ] 冷却正常工作

### 冰冻技能测试
- [ ] 敌人完全停止移动
- [ ] 3秒后自动解冻
- [ ] 视觉效果清晰
- [ ] 不影响塔攻击
- [ ] 飞行单位也能冻结

### 闪电链测试
- [ ] 正确跳跃到附近敌人
- [ ] 伤害衰减计算正确
- [ ] 最多跳5次
- [ ] 不跳到已死亡敌人
- [ ] 视觉连线清晰

### UI测试
- [ ] 冷却时间准确显示
- [ ] 金币不足时禁用
- [ ] 目标选择流畅
- [ ] 快捷键响应（可选）

---

## 🎮 使用体验优化

### 快捷键（可选）
- `1` - 空袭
- `2` - 冰冻
- `3` - 闪电链
- `Esc` - 取消选择

### 智能提示
- 技能范围预览
- 敌人数量统计
- 伤害预估
- 最佳使用时机提示

---

## 📈 数据平衡

### 初始设定
| 技能 | 伤害 | 范围 | 冷却 | 成本 | 期望使用频率 |
|------|------|------|------|------|-------------|
| 空袭 | 150 | 2.5 | 60s | 100 | 每波1-2次 |
| 冰冻 | 0 | 3.0 | 45s | 80 | 每波2-3次 |
| 闪电链 | 80 | 链式 | 30s | 60 | 每波3-4次 |

### 调优方向
- 根据玩家使用频率调整冷却
- 根据胜率调整伤害/成本
- 根据策略多样性调整效果

---

## 🎯 第二阶段目标

完成后玩家将拥有：
- ✅ 3种强力主动技能
- ✅ 直观的技能UI
- ✅ 流畅的选择机制
- ✅ 华丽的视觉效果
- ✅ 更高的策略深度

---

准备好开始实现了吗？我建议从以下顺序开始：
1. 创建技能系统核心类
2. 实现空袭技能（最简单）
3. 创建技能UI组件
4. 实现冰冻和闪电链
5. 添加视觉效果优化

你觉得怎么样？要开始了吗？ 🚀




