# 科技树系统设计说明

## 📋 系统概述

当建筑升级到3级（最高级）时，可以解锁该建筑的科技树。每个建筑可以有多个科技分支，科技之间有依赖关系。研发科技需要消耗金币，并会对建筑产生各种效果加成。

---

## 🏗️ 已设计的科技树

### 1. **工厂 (factory)** - 4个科技
```
自动化生产 (2000金币)
├─ 产出+30%, 稳定度+5%
└─ 智能工厂 (4000金币) [需要自动化生产]
   └─ 产出+50%, 效率+20%, 电力-15%

环保改造 (2500金币)
├─ 污染-40%, 稳定度+8%
└─ 零污染技术 (5000金币) [需要环保改造]
   └─ 污染-100%, 稳定度+15%, 产出+10%
```

**设计思路**：
- 两条独立分支：效率路线 vs 环保路线
- 自动化生产提升产出和稳定度（居民幸福度）
- 智能工厂需要先研发自动化，进一步提升效率
- 环保路线可以最终实现零污染

---

### 2. **化学工厂 (chemistry_factory)** - 4个科技
```
安全防护系统 (3000金币)
├─ 稳定度+10%, 污染-20%
└─ 绿色化学技术 (4500金币) [需要安全防护]
   └─ 污染-50%, 稳定度+12%, 产出+15%

先进化学工艺 (3500金币)
└─ AI化学合成 (6000金币) [需要先进工艺+绿色化学]
   └─ 产出+60%, 效率+30%, 污染-30%, 电力-20%
```

**设计思路**：
- 安全路线：先提升安全性，再发展绿色技术
- 效率路线：直接提升产出和效率
- 最终科技需要两个前置，形成科技融合

---

### 3. **商店 (shop)** - 3个科技
```
数字化经营 (1500金币)
└─ 智能零售 (3000金币) [需要数字化]
   └─ 收入+45%, 稳定度+6%

绿色商店 (2000金币)
└─ 污染-30%, 电力-20%, 稳定度+5%
```

**设计思路**：
- 数字化路线：提升收入和效率
- 绿色路线：降低环境影响
- 两条路线可以同时研发

---

### 4. **办公室 (office)** - 3个科技
```
远程办公系统 (2500金币)
└─ AI办公助手 (4000金币) [需要远程办公]
   └─ 收入+50%, 效率+30%

绿色办公 (2000金币)
└─ 污染-25%, 电力-25%, 稳定度+6%
```

**设计思路**：
- 远程办公提升员工满意度（稳定度）
- AI助手大幅提升效率
- 绿色办公降低环境影响

---

### 5. **住宅 (house)** - 3个科技
```
智能家居 (1800金币)
├─ 人口+20%, 稳定度+10%, 电力-10%
└─ 社区服务 (3000金币) [需要智能家居]
   └─ 稳定度+15%, 人口+15%, 产出+10%

生态住宅 (2200金币)
└─ 污染-30%, 电力-20%, 稳定度+8%
```

**设计思路**：
- 智能家居提升居住体验和容量
- 社区服务进一步改善生活质量
- 生态住宅降低环境影响

---

### 6. **民宅 (house2)** - 3个科技
```
太阳能屋顶 (2000金币)
├─ 电力-50%, 污染-20%, 稳定度+8%
└─ 智能民宅 (3500金币) [需要太阳能+屋顶花园]
   └─ 人口+25%, 稳定度+15%, 电力-30%, 污染-20%

屋顶花园 (1500金币)
└─ 人口+15%, 污染-15%, 稳定度+10%
```

**设计思路**：
- 太阳能屋顶实现能源自给
- 屋顶花园改善环境
- 最终科技需要两个前置，形成完整生态

---

### 7. **垃圾站 (garbage_station)** - 3个科技 ⭐重点
```
垃圾分类回收 (2000金币)
├─ 处理能力+30%, 污染-20%, 产出+10%
└─ 黑科技处理 (4000金币) [需要垃圾分类]
   └─ 处理能力+60%, 效率+40%, 污染-40%, 产出+20%
       └─ 零废弃技术 (6000金币) [需要黑科技]
          └─ 处理能力+100%, 污染-60%, 产出+30%, 稳定度+10%
```

**设计思路**：
- 单一路线，逐步升级
- 垃圾分类 → 黑科技处理 → 零废弃技术
- 最终实现完全零废弃，所有垃圾回收利用
- 符合用户提到的"垃圾处理黑科技"

---

### 8. **公园 (hero_park)** - 3个科技
```
生态公园 (1500金币)
├─ 污染-30%, 稳定度+10%
└─ 智能公园 (2500金币) [需要生态公园]
   └─ 稳定度+15%, 污染-20%
       └─ 碳汇技术 (4000金币) [需要智能公园]
          └─ 污染-50%, 稳定度+20%
```

**设计思路**：
- 单一路线，逐步提升环境改善能力
- 从生态到智能再到碳汇技术
- 最终大幅提升环境质量和稳定度

---

### 9. **太阳能板 (sun_power)** - 3个科技
```
高效太阳能 (2000金币)
├─ 发电量+30%, 效率+20%
└─ 储能技术 (3000金币) [需要高效太阳能]
   └─ 发电量+20%, 稳定度+8%
       └─ AI智能追踪 (5000金币) [需要储能技术]
          └─ 发电量+50%, 效率+40%
```

**设计思路**：
- 单一路线，逐步提升发电效率
- 从高效到储能再到AI优化
- 最终实现最大化发电效率

---

### 10. **风力发电 (wind_power)** - 2个科技
```
先进风机技术 (2500金币)
├─ 发电量+35%, 效率+25%
└─ 海上风电技术 (4000金币) [需要先进风机]
   └─ 发电量+60%, 稳定度+5%
```

**设计思路**：
- 单一路线，提升发电能力
- 借鉴海上风电技术，大幅提升发电量

---

### 11. **核电站 (nuke_factory)** - 2个科技
```
安全防护升级 (5000金币)
├─ 稳定度+15%, 污染-20%
└─ 核聚变技术 (8000金币) [需要安全防护]
   └─ 发电量+50%, 污染-40%, 稳定度+10%
```

**设计思路**：
- 单一路线，先提升安全性
- 最终采用核聚变技术，大幅提升效率和安全性

---

## 🎯 设计特点

### 1. **科技依赖关系**
- 大部分科技有前置要求
- 形成清晰的科技树结构
- 鼓励玩家规划科技研发路径

### 2. **效果多样性**
- **产出加成**：提升建筑产出（收入/发电量）
- **污染减少**：降低环境污染
- **稳定度提升**：提升居民满意度（符合用户需求）
- **效率提升**：提升建筑运行效率
- **容量增加**：提升人口容量或处理能力
- **电力优化**：降低电力消耗

### 3. **成本平衡**
- 基础科技：1500-3000金币
- 中级科技：3000-5000金币
- 高级科技：5000-8000金币
- 成本与效果成正比

### 4. **路线选择**
- **效率路线**：提升产出和效率
- **环保路线**：降低污染，提升稳定度
- **平衡路线**：兼顾效率和环保

---

## 📊 科技效果统计

### 按建筑类型统计：
- **工厂**：4个科技，2条路线
- **化学工厂**：4个科技，2条路线（最终融合）
- **商店**：3个科技，2条路线
- **办公室**：3个科技，2条路线
- **住宅**：3个科技，2条路线
- **民宅**：3个科技，2条路线（最终融合）
- **垃圾站**：3个科技，1条路线（重点设计）
- **公园**：3个科技，1条路线
- **太阳能板**：3个科技，1条路线
- **风力发电**：2个科技，1条路线
- **核电站**：2个科技，1条路线

**总计**：34个科技，覆盖11种建筑类型

---

## 🔧 技术实现要点

### 1. **科技解锁条件**
- 建筑必须达到3级（最高级）
- 前置科技必须已研发
- 有足够的金币

### 2. **科技效果应用**
- 科技效果以百分比加成形式应用
- 多个科技效果可以叠加
- 效果实时影响建筑属性

### 3. **数据存储**
- 每个建筑实例存储已研发的科技ID列表
- 全局存储所有建筑的科技研发状态
- 支持科技研发状态的保存和加载

---

## 💡 使用示例

### 工厂科技树使用：
```javascript
// 1. 建筑升级到3级后，显示科技树按钮
if (building.level === 3) {
  showTechTreeButton(building)
}

// 2. 点击科技树，显示可研发的科技
const techs = getTechsByBuildingType('factory')
const availableTechs = techs.filter(tech => 
  isTechUnlocked(tech.id, building.researchedTechs)
)

// 3. 研发科技
function researchTech(building, techId) {
  const tech = getTechById(techId)
  if (gameState.credits >= tech.cost) {
    gameState.updateCredits(-tech.cost)
    building.researchedTechs.push(techId)
    applyTechEffects(building, tech)
  }
}

// 4. 应用科技效果
function applyTechEffects(building, tech) {
  if (tech.effects.output) {
    building.coinOutput *= (1 + tech.effects.output)
  }
  if (tech.effects.stability) {
    // 提升城市稳定度
    gameState.stability += tech.effects.stability * 100
  }
  // ... 其他效果
}
```

---

## 🎮 游戏玩法建议

### 1. **策略选择**
- 玩家需要选择研发路线（效率 vs 环保）
- 不同路线适合不同的游戏策略
- 可以同时研发多条路线（需要更多资源）

### 2. **资源规划**
- 科技研发需要大量金币
- 需要平衡建筑建造和科技研发
- 优先研发关键科技

### 3. **科技组合**
- 不同建筑的科技可以形成组合效果
- 例如：工厂自动化 + 住宅智能家居 = 工业区智能化
- 鼓励玩家探索科技组合

---

## 📝 后续扩展建议

1. **跨建筑科技**：某些科技可以影响多个建筑类型
2. **科技研究点数**：除了金币，还可以使用研究点数
3. **科技研发时间**：某些高级科技需要时间研发
4. **科技失效**：某些科技可能有时间限制或条件限制
5. **科技升级**：已研发的科技可以进一步升级

---

## ✅ 总结

科技树系统设计完成，包含：
- ✅ 11种建筑类型的科技树
- ✅ 34个科技配置
- ✅ 清晰的依赖关系
- ✅ 多样化的效果类型
- ✅ 平衡的成本设计
- ✅ 符合用户需求的稳定度提升效果

系统已准备好集成到游戏中！

