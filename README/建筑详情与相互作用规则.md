# 建筑详情与相互作用规则文档

## 📋 目录
1. [建筑分类](#建筑分类)
2. [建筑详情](#建筑详情)
3. [建筑相互作用规则](#建筑相互作用规则)
4. [道路约束规则](#道路约束规则)
5. [建筑属性说明](#建筑属性说明)

---

## 建筑分类

游戏中的建筑分为以下7大类：
- **住宅 (Residential)** - 提供人口容量
- **商业 (Commercial)** - 产生金币收入
- **工业 (Industrial)** - 产生金币收入，但产生污染
- **基础设施 (Infrastructure)** - 道路等基础建设
- **环境 (Environment)** - 减少污染，可能发电
- **社会 (Social)** - 提供社会服务
- **治理 (Governance)** - 提供公共服务

---

## 建筑详情

### 🏠 住宅建筑

#### 1. 住宅 (house)
- **图标**: 🏠
- **类型**: 住宅建筑
- **分类**: residential

| 等级 | 名称 | 建造成本 | 最大人口 | 电力消耗 | 污染 | 金币产出 | 升级成本 | 下一级 |
|------|------|----------|----------|----------|------|----------|----------|--------|
| 1 | 普通住宅 | 300 | 30 | 10 | 2 | 5 | 600 | 2 |
| 2 | 高级住宅 | 600 | 72 | 15 | 3 | 11 | 1200 | 3 |
| 3 | 豪华住宅 | 1200 | 120 | 20 | 5 | 24 | - | - |

**说明**: 提供人口容量，覆盖工厂和商店的就业需求。

---

#### 2. 民宅 (house2)
- **图标**: 🏡
- **类型**: 住宅建筑
- **分类**: residential

| 等级 | 名称 | 建造成本 | 最大人口 | 电力消耗 | 污染 | 金币产出 | 升级成本 | 下一级 |
|------|------|----------|----------|----------|------|----------|----------|--------|
| 1 | 普通民宅 | 400 | 39 | 8 | 1 | 7 | 800 | 2 |
| 2 | 高级民宅 | 800 | 98 | 12 | 2 | 14 | 1600 | 3 |
| 3 | 豪华民宅 | 1600 | 156 | 18 | 3 | 32 | - | - |

**说明**: 另一种住宅类型，人口容量略高于普通住宅。

---

### 🏭 工业建筑

#### 3. 工厂 (factory)
- **图标**: 🏭
- **类型**: 工业建筑
- **分类**: industrial
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 金币产出 | 工作岗位 | 升级成本 | 下一级 |
|------|------|----------|----------|------|----------|----------|----------|--------|
| 1 | 普通工厂 | 500 | 40 | 22 | 70 | 20 | - | - |

**说明**: 基础工业建筑，产生较高收入但污染严重。

---

#### 4. 化学工厂 (chemistry_factory)
- **图标**: 🧪
- **类型**: 化学工厂
- **分类**: industrial
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 金币产出 | 工作岗位 | 升级成本 | 下一级 |
|------|------|----------|----------|------|----------|----------|----------|--------|
| 1 | 化学工厂 | 1000 | 60 | 45 | 140 | 35 | 1500 | 2 |
| 2 | 高级化学工厂 | 1500 | 80 | 65 | 240 | 55 | 2000 | 3 |
| 3 | 现代化化学工厂 | 2000 | 100 | 90 | 350 | 80 | - | - |

**说明**: 高级工业建筑，产出更高但污染更严重。

---

#### 5. 核电站 (nuke_factory)
- **图标**: ☢️
- **类型**: 核电站
- **分类**: industrial (实际为商业分类)
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力产出 | 污染 | 金币产出 | 工作岗位 |
|------|------|----------|----------|------|----------|----------|
| 1 | 核电站 | 5000 | 300 | 40 | 0 | 50 |

**说明**: 大型发电设施，提供大量电力但有一定污染。

---

### 🏬 商业建筑

#### 6. 商店 (shop)
- **图标**: 🏬
- **类型**: 商业建筑
- **分类**: commercial
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 金币产出 | 工作岗位 | 升级成本 | 下一级 |
|------|------|----------|----------|------|----------|----------|----------|--------|
| 1 | 普通商店 | 400 | 15 | 6 | 24 | 10 | 800 | 2 |
| 2 | 高级商店 | 800 | 25 | 8 | 60 | 20 | 1600 | 3 |
| 3 | 购物中心 | 1600 | 40 | 12 | 140 | 40 | - | - |

**说明**: 商业建筑，产生稳定收入。

---

#### 7. 办公室 (office)
- **图标**: 🏢
- **类型**: 办公建筑
- **分类**: commercial
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 金币产出 | 工作岗位 | 升级成本 | 下一级 |
|------|------|----------|----------|------|----------|----------|----------|--------|
| 1 | 普通办公室 | 500 | 30 | 7 | 30 | 15 | 1000 | 2 |
| 2 | 高级办公室 | 1000 | 45 | 12 | 80 | 30 | 2000 | 3 |
| 3 | 商务中心 | 2000 | 65 | 18 | 180 | 60 | - | - |

**说明**: 办公建筑，提供更多工作岗位。

---

### 🌳 环境设施

#### 8. 公园 (park)
- **图标**: 🌳
- **类型**: 环境设施
- **分类**: social
- **需要道路**: ❌ (可随意建造)

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 人口 | 升级成本 | 下一级 |
|------|------|----------|----------|------|------|----------|--------|
| 1 | 小公园 | 200 | 5 | -10 | 0 | 400 | 2 |
| 2 | 社区公园 | 400 | 8 | -20 | 0 | 800 | 3 |
| 3 | 城市公园 | 800 | 12 | -40 | 0 | - | - |

**说明**: 减少污染，提升周围建筑效率。

---

#### 9. 垃圾站 (garbage_station)
- **图标**: 🗑️
- **类型**: 环境设施
- **分类**: environment
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 人口 |
|------|------|----------|----------|------|------|
| 1 | 垃圾站 | 500 | 20 | -15 | 10 |

**说明**: 处理垃圾，减少污染。

---

#### 10. 太阳能电板 (sun_power)
- **图标**: ☀️
- **类型**: 环境设施
- **分类**: environment
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力产出 | 污染 | 人口 | 金币产出 |
|------|------|----------|----------|------|------|----------|
| 1 | 太阳能电板 | 800 | 50 | -10 | 5 | 0 |

**说明**: 清洁能源，减少污染。

---

#### 11. 水塔 (water_tower)
- **图标**: 🚰
- **类型**: 环境设施
- **分类**: environment
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 人口 |
|------|------|----------|----------|------|------|
| 1 | 水塔 | 700 | 15 | 0 | 3 |

**说明**: 基础设施，提升周围工厂效率。

---

#### 12. 风力发电塔 (wind_power)
- **图标**: 🌬️
- **类型**: 环境设施
- **分类**: environment
- **需要道路**: ❌ (可随意建造)

| 等级 | 名称 | 建造成本 | 电力产出 | 污染 | 人口 | 金币产出 |
|------|------|----------|----------|------|------|----------|
| 1 | 风力发电塔 | 900 | 70 | -15 | 5 | 0 |

**说明**: 清洁能源，减少污染。

---

#### 13. 英雄纪念碑 (hero_park)
- **图标**: 🗽
- **类型**: 社会设施
- **分类**: social
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 人口 |
|------|------|----------|----------|------|------|
| 1 | 英雄纪念碑 | 1200 | 10 | -5 | 0 |

**说明**: 社会设施，类似公园效果。

---

### 🏥 治理设施

#### 14. 医院 (hospital)
- **图标**: 🏥
- **类型**: 社会设施
- **分类**: governance
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 人口 |
|------|------|----------|----------|------|------|
| 1 | 医院 | 1000 | 40 | 0 | 40 |

**说明**: 提供医疗服务，提升稳定度。

---

#### 15. 警察局 (police)
- **图标**: 👮
- **类型**: 治理设施
- **分类**: governance
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 人口 |
|------|------|----------|----------|------|------|
| 1 | 警察局 | 1200 | 30 | 0 | 25 |

**说明**: 提供治安服务，提升稳定度。

---

#### 16. 消防站 (fire_station)
- **图标**: 🚒
- **类型**: 社会设施
- **分类**: governance
- **需要道路**: ✅

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 人口 |
|------|------|----------|----------|------|------|
| 1 | 消防站 | 900 | 35 | 0 | 20 |

**说明**: 提供消防服务，提升稳定度。

---

### 🛣️ 基础设施

#### 17. 道路 (road)
- **图标**: 🛣️
- **类型**: 道路
- **分类**: infrastructure
- **需要道路**: ❌ (可随意建造)

| 等级 | 名称 | 建造成本 | 电力消耗 | 污染 | 人口 |
|------|------|----------|----------|------|------|
| 1 | 道路 | 0 | 0 | 0 | 0 |

**说明**: 所有建筑（除公园、风力发电塔外）必须相邻道路才能建造。

---

## 建筑相互作用规则

### 📊 相互作用类型

建筑之间的相互作用分为两类：
1. **数值修正器 (modifiers)** - 影响建筑的数值属性（产出、污染、人口等）
2. **状态效果 (statusEffects)** - 显示UI状态图标（如快乐、悲伤、增益等）

---

### 🏭 化学工厂 (chemistry_factory)

#### 数值修正器

**污染修正**:
- 附近3格内有 `factory` → 污染 **+20%** (工业集群效应)
- 附近2格内有 `garbage_station` → 污染 **-30%** (垃圾站处理废料)

**收入修正**:
- 附近2格内有 `factory` → 收入 **+20%** (工业集群协同效应)
- 附近3格内有 `garbage_station` 或 `park` → 收入 **+15%** (良好环境提升生产效率)

#### 状态效果
- 缺少工厂支持（3格内无工厂）→ 显示 `pollutionUpBuff` 图标
- 缺少垃圾站（3格内无垃圾站）→ 显示 `pollutionUpBuff` 图标
- 有垃圾站处理（3格内有垃圾站）→ 显示 `pollutionDownBuff` 图标

---

### 🗑️ 垃圾站 (garbage_station)

#### 状态效果
- 附近3格内有 `factory` 或 `chemistry_factory` → 显示 `pollutionLowerBuff` 图标

---

### 🏭 工厂 (factory)

#### 数值修正器

**污染修正**:
- 相邻1格有 `park`、`hero_park`、`sun_power`、`wind_power` → 污染 **-25%** (每个，可叠加)
- 相邻1格有 `chemistry_factory` → 污染 **-25%** (不可叠加)

**收入修正**:
- 相邻1格有 `water_tower` → 收入 **+25%** (每个，可叠加，最多4层)

#### 状态效果
- 缺少绿化（1格内无公园/英雄纪念碑/太阳能/风力）→ 显示 `pollutionUpBuff` 图标

---

### 🚰 水塔 (water_tower)

#### 状态效果
- 相邻1格有 `shop` → 显示 `coinBuff` 图标

---

### 🏬 商店 (shop)

#### 数值修正器

**收入修正**:
- 相邻1格有 `park` 或 `hero_park` → 收入 **+10%** (每个，可叠加，最多4层)

#### 状态效果
- 相邻1格有 `park` 或 `hero_park` → 显示 `happy` 图标

---

### 🏢 办公室 (office)

#### 数值修正器

**收入修正**:
- 相邻1格有 `park` 或 `hero_park` → 收入 **+12%** (每个，可叠加，最多4层)

#### 状态效果
- 相邻1格有 `park` 或 `hero_park` → 显示 `happy` 图标

---

### 🏠 住宅 (house)

#### 数值修正器

**人口容量修正**:
- 相邻1格有 `park` 或 `hero_park` → 最大人口 **+10%** (每个，可叠加，最多4层)
- 相邻1格有 `factory` 或 `chemistry_factory` → 最大人口 **-15%** (每个，可叠加，最多4层)

#### 状态效果
- 相邻1格有 `park` 或 `hero_park` → 显示 `happy` 图标
- 相邻1格有 `factory` 或 `chemistry_factory` → 显示 `sad` 图标

---

### 🏡 民宅 (house2)

#### 数值修正器

**人口容量修正**:
- 相邻1格有 `park` 或 `hero_park` → 最大人口 **+10%** (每个，可叠加，最多4层)
- 相邻1格有 `factory` 或 `chemistry_factory` → 最大人口 **-15%** (每个，可叠加，最多4层)

#### 状态效果
- 相邻1格有 `park` 或 `hero_park` → 显示 `happy` 图标
- 相邻1格有 `factory` 或 `chemistry_factory` → 显示 `sad` 图标

---

### ☀️ 太阳能电板 (sun_power)

#### 数值修正器

**电力产出修正**:
- 相邻1格有 `house` 或 `house2` → 发电效率 **+5%** (每个，可叠加，最多4层)
- 相邻1格有 `sun_power` 或 `wind_power` → 发电效率 **+5%** (每个，可叠加，最多4层)

#### 状态效果
- 相邻1格有 `house`、`house2`、`wind_power`、`sun_power` → 显示 `powerBuff` 图标
- 相邻1格有 `factory` 或 `chemistry_factory` → 显示 `pollutionDownBuff` 图标

---

### 🌬️ 风力发电塔 (wind_power)

#### 数值修正器

**电力产出修正**:
- 相邻1格有 `park` 或 `hero_park` → 发电效率 **+8%** (每个，可叠加，最多4层)

#### 状态效果
- 相邻1格有 `park` 或 `hero_park` → 显示 `powerup` 图标

---

### 🌳 公园 (park)

#### 状态效果
- 相邻1格有 `house` 或 `house2` → 显示 `humanBuff` 图标
- 相邻1格有 `shop` 或 `office` → 显示 `coinBuff` 图标
- 相邻1格有 `factory` 或 `chemistry_factory` → 显示 `pollutionDownBuff` 图标

---

## 道路约束规则

### ✅ 可随意建造的建筑（不需要相邻道路）
- `road` (道路)
- `park` (公园)
- `wind_power` (风力发电塔)

### ❌ 必须相邻道路的建筑
**除上述3种建筑外，所有其他建筑都必须至少有一个相邻格子是道路才能建造。**

包括：
- 所有住宅建筑 (`house`, `house2`)
- 所有工业建筑 (`factory`, `chemistry_factory`, `nuke_factory`)
- 所有商业建筑 (`shop`, `office`)
- 所有环境设施 (`garbage_station`, `sun_power`, `water_tower`)
- 所有社会设施 (`hero_park`)
- 所有治理设施 (`hospital`, `police`, `fire_station`)

---

## 建筑属性说明

### 基础属性

- **cost**: 建造成本（金币）
- **maxPopulation**: 最大人口容量（住宅建筑）
- **population**: 工作岗位数量（非住宅建筑）
- **powerUsage**: 电力消耗（负数表示消耗）
- **powerOutput**: 电力产出（正数表示产出）
- **pollution**: 污染值（负数表示减少污染）
- **coinOutput**: 金币产出（每日收入）

### 升级系统

- **upgradeCost**: 升级到下一等级的成本（`null` 表示无法升级）
- **nextLevel**: 下一等级编号（`null` 表示无下一等级）
- **visible**: 是否在建造菜单中可见（`false` 表示需要通过升级获得）

### 相互作用范围

- **range**: 相互作用范围（格子数）
  - `1` = 相邻（上下左右）
  - `2` = 2格范围内
  - `3` = 3格范围内
- **stackable**: 效果是否可叠加
- **maxStacks**: 最大叠加层数（如果可叠加）
- **requireAll**: 是否需要所有目标建筑都存在（`false` 表示只需要其中一种）

### 状态效果类型

- `happy` - 快乐图标
- `sad` - 悲伤图标
- `coinBuff` - 金币增益图标
- `powerBuff` / `powerup` - 电力增益图标
- `pollutionUpBuff` - 污染上升警告图标
- `pollutionDownBuff` / `pollutionLowerBuff` - 污染下降图标
- `humanBuff` - 人口增益图标

---

## 系统状态对收入的影响

### 📊 系统状态概述

游戏中有四个核心系统状态，它们会动态影响城市的每日收入：
- **电网 (Power Grid)** - 电力供应系统
- **交通 (Transport)** - 道路连通性系统
- **安全 (Security)** - 城市稳定度系统
- **环境 (Environment)** - 污染控制系统

### 🎯 系统状态等级

每个系统都有5个状态等级，从优秀到严重：

| 等级 | 中文名称 | 英文名称 | 收入影响倍数 | 说明 |
|------|----------|----------|--------------|------|
| 1 | 优秀 | Excellent | **+10%** | 系统运行良好，收入提升 |
| 2 | 良好 | Good | **0%** (不变) | 系统正常，无影响 |
| 3 | 适中 | Moderate | **-10%** | 系统一般，收入略微下降 |
| 4 | 受限 | Limited | **-25%** | 系统受限，收入明显下降 |
| 5 | 严重 | Critical | **-50%** | 系统严重问题，收入大幅下降 |

### ⚡ 电网系统 (Power Grid)

**计算方式**: 耗电量 / 发电量 比例

| 比例范围 | 状态等级 | 说明 |
|----------|----------|------|
| ≤ 50% | 优秀 (1级) | 电力充足，有大量余量 |
| ≤ 70% | 良好 (2级) | 电力充足，运行正常 |
| ≤ 90% | 适中 (3级) | 电力紧张，接近满载 |
| ≤ 100% | 受限 (4级) | 电力刚好满足需求 |
| > 100% | 严重 (5级) | 电力不足，存在缺口 |

**影响**: 电力不足会导致建筑无法正常运行，严重影响收入。

---

### 🛣️ 交通系统 (Transport)

**计算方式**: 最长连通道路数 / 总道路数 比例

| 比例范围 | 状态等级 | 说明 |
|----------|----------|------|
| ≥ 90% | 优秀 (1级) | 道路高度连通，交通便利 |
| ≥ 70% | 良好 (2级) | 道路连通良好，交通顺畅 |
| ≥ 50% | 适中 (3级) | 道路部分连通，交通一般 |
| ≥ 30% | 受限 (4级) | 道路连通性差，交通受限 |
| < 30% | 严重 (5级) | 道路严重分割，交通瘫痪 |

**影响**: 道路连通性差会导致物流效率下降，影响商业和工业收入。

**计算方法**: 使用BFS（广度优先搜索）算法找到所有道路中最大的连通区域，计算该区域道路数占总道路数的比例。

---

### 🛡️ 安全系统 (Security)

**计算方式**: 基于城市稳定度 (Stability)

| 稳定度范围 | 状态等级 | 说明 |
|------------|----------|------|
| ≥ 90 | 优秀 (1级) | 城市非常稳定，居民满意度高 |
| ≥ 75 | 良好 (2级) | 城市稳定，运行正常 |
| ≥ 60 | 适中 (3级) | 城市基本稳定，存在小问题 |
| ≥ 40 | 受限 (4级) | 城市不稳定，存在较大问题 |
| < 40 | 严重 (5级) | 城市严重不稳定，危机四伏 |

**影响**: 稳定度低会导致居民流失、商业活动减少，直接影响收入。

---

### 🌍 环境系统 (Environment)

**计算方式**: 总污染值 / (地图大小² × 2) 比例

| 污染比例范围 | 状态等级 | 说明 |
|--------------|----------|------|
| ≤ 20% | 优秀 (1级) | 环境优良，污染极低 |
| ≤ 40% | 良好 (2级) | 环境良好，污染较低 |
| ≤ 60% | 适中 (3级) | 环境一般，污染中等 |
| ≤ 80% | 受限 (4级) | 环境较差，污染较高 |
| > 80% | 严重 (5级) | 环境恶劣，污染严重 |

**影响**: 高污染会导致居民健康问题、商业活动减少，严重影响收入。

**污染阈值计算**: `污染阈值 = 地图大小 × 地图大小 × 2`

例如：16×16地图的污染阈值为 `16 × 16 × 2 = 512`

---

### 💰 收入影响计算

**最终收入 = 基础收入 × 平均影响倍数**

**平均影响倍数** = (电网倍数 + 交通倍数 + 安全倍数 + 环境倍数) / 4

**示例**:
- 基础收入: 10,000 金币
- 电网: 1级 (+10%) → 1.1
- 交通: 2级 (0%) → 1.0
- 安全: 3级 (-10%) → 0.9
- 环境: 4级 (-25%) → 0.75

平均倍数 = (1.1 + 1.0 + 0.9 + 0.75) / 4 = 0.9375

**最终收入** = 10,000 × 0.9375 = **9,375 金币**

---

### 📈 优化建议

1. **保持电力充足**: 确保发电量至少是耗电量的1.5倍以上，以获得优秀评级
2. **规划道路网络**: 避免道路分割，确保所有道路连通，形成完整的交通网络
3. **维持稳定度**: 通过建设医院、警察局、消防站等治理设施，保持稳定度在75以上
4. **控制污染**: 在工业区周围建设公园、垃圾站等环境设施，将污染控制在阈值40%以下
5. **平衡发展**: 四个系统需要平衡发展，任何一个系统的严重问题都会显著影响收入

---

## 📝 总结

1. **道路是基础**: 除公园和风力发电塔外，所有建筑都需要相邻道路
2. **布局很重要**: 建筑之间的相互作用会显著影响产出、污染和人口
3. **环境平衡**: 工业建筑需要环境设施来减少污染
4. **协同效应**: 同类建筑相邻可以产生协同效应（如工厂集群）
5. **优化策略**: 合理规划建筑布局，最大化正面效果，最小化负面影响
6. **系统状态**: 四个核心系统状态会动态影响每日收入，需要平衡发展

---

*最后更新: 2025-01-XX*
